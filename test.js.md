# Snapshot report for `test.js`

The actual snapshot is saved in `test.js.snap`.

Generated by [AVA](https://avajs.dev).

## snapshot for a bunch of commands

> seam-plop ava-config

    {
      'test-output/ava.config.js': `// Generated by seam-plop␊
      module.exports = {␊
        files: ["src/tests/**/*.test.ts"],␊
        extensions: ["ts"],␊
        require: ["esbuild-register"],␊
        ignoredByWatcher: [".next", ".nsm"],␊
      }`,
      'test-output/package.json': `{␊
        "name": "test-output",␊
        "version": "1.0.0",␊
        "main": "index.js",␊
        "license": "MIT"␊
      }␊
      `,
    }

> seam-plop gitignore

    {
      'test-output/.prettierrc': `node_modules␊
      dist␊
      .vercel␊
      .next␊
      yarn-error.log␊
      .nsm␊
      .vscode␊
      .env*␊
      !.env.example␊
      .DS_Store␊
      .yalc␊
      yalc.lock`,
      'test-output/package.json': `{␊
        "name": "test-output",␊
        "version": "1.0.0",␊
        "main": "index.js",␊
        "license": "MIT"␊
      }␊
      `,
    }

> seam-plop prettierrc

    {
      'test-output/.prettierrc': '{ "semi": false }',
      'test-output/package.json': `{␊
        "name": "test-output",␊
        "version": "1.0.0",␊
        "main": "index.js",␊
        "license": "MIT"␊
      }␊
      `,
    }

> seam-plop node-pg-migrate

    {
      'test-output/package.json': `{␊
        "name": "test-output",␊
        "version": "1.0.0",␊
        "main": "index.js",␊
        "license": "MIT",␊
        "scripts": {␊
          "db:create-migration": "node-pg-migrate --migration-file-language ts -m src/db/migrations create",␊
          "db:migrate": "esr src/scripts/migrate-db.ts",␊
          "db:reset": "esr src/scripts/reset-db.ts"␊
        }␊
      }`,
      'test-output/src/lib/db/migrate-db.ts': `import nodePgMigrate from "node-pg-migrate"␊
      import getDB from "db/get-db"␊
      import * as zg from "zapatos/generate"␊
      import { Client } from "pg"␊
      import Debug from "debug"␊
      ␊
      const debug = Debug("MY_PROJECT_NAME")␊
      ␊
      export const migrate = async ({␊
        database_url,␊
        db,␊
        update_typings = false,␊
        silent = false,␊
      }: {␊
        database_url?: string␊
        db?: any␊
        update_typings?: boolean␊
        silent?: boolean␊
      } = {}) => {␊
        let client␊
      ␊
        if (!database_url) {␊
          const conn = db?.connection || getDB.getConnectionInfo()␊
          client = new Client(conn)␊
          const { host, password, port, database, user, ssl } = conn␊
          database_url = \`postgresql://${user}:${password}@${host}:${port}/${database}${␊
            ssl ? "?sslmode=no-verify" : ""␊
          }\`␊
        }␊
      ␊
        client = new Client({␊
          connectionString: database_url,␊
        })␊
      ␊
        await client.connect()␊
      ␊
        let logger␊
      ␊
        if (silent) {␊
          logger = {␊
            ...console,␊
            info: () => null,␊
            log: () => null,␊
          }␊
        } else {␊
          logger =␊
            debug.enabled || process.env.NODE_ENV !== "test"␊
              ? console␊
              : {␊
                  ...console,␊
                  info: () => null,␊
                  log: () => null,␊
                }␊
        }␊
      ␊
        await Promise.all([␊
          nodePgMigrate({␊
            dbClient: client,␊
            direction: "up",␊
            schema: "migrations",␊
            createSchema: true,␊
            migrationsTable: "pgmigrations",␊
            verbose: false,␊
            dir: "./db/migrations",␊
            logger,␊
          } as any),␊
          // TODO put graphile worker migration here␊
        ])␊
      ␊
        if (update_typings) {␊
          const schemas = [␊
            // TODO insert schemas to type␊
          ]␊
          await zg.generate({␊
            db: {␊
              connectionString: database_url,␊
            },␊
            schemas: Object.fromEntries(␊
              schemas.map((s) => [␊
                s,␊
                {␊
                  include: "*",␊
                  exclude: [],␊
                },␊
              ])␊
            ),␊
            outDir: "./src/db",␊
          })␊
        }␊
      ␊
        await client.end()␊
      }␊
      ␊
      export default migrate`,
      'test-output/src/lib/db/reset-db.ts': '',
      'test-output/src/scripts/migrate-db.ts': `import migrateDb from "lib/migrate-db"␊
      ␊
      migrateDb()`,
      'test-output/src/scripts/reset-db.ts': `import resetDb from "lib/reset-db"␊
      ␊
      resetDb()`,
    }

> seam-plop github-ci-test no

    {
      'test-output/.github/workflows/npm-test.yml': `# Generated by seam-plop␊
      name: NPM Test␊
      on: ["pull_request"]␊
      jobs:␊
        npm_test:␊
          if: "!contains(github.event.head_commit.message, 'skip ci')"␊
          name: Run NPM Test␊
          runs-on: ubuntu-20.04␊
          steps:␊
            - name: Checkout␊
              uses: actions/checkout@v1␊
            - name: Setup Node.js␊
              uses: actions/setup-node@v1␊
              with:␊
                node-version: 16␊
            - name: Run NPM Install␊
              run: yarn install␊
            - name: Run NPM Test␊
              run: yarn test␊
      `,
      'test-output/package.json': `{␊
        "name": "test-output",␊
        "version": "1.0.0",␊
        "main": "index.js",␊
        "license": "MIT"␊
      }␊
      `,
    }

> seam-plop github-ci-test yes

    {
      'test-output/.github/workflows/npm-test.yml': `# Generated by seam-plop␊
      name: NPM Test␊
      on: ["pull_request"]␊
      jobs:␊
        npm_test:␊
          if: "!contains(github.event.head_commit.message, 'skip ci')"␊
          name: Run NPM Test␊
          runs-on: ubuntu-20.04␊
          services:␊
            postgres:␊
              image: postgres␊
              env:␊
                POSTGRES_HOST_AUTH_METHOD: trust␊
              options: >-␊
                --health-cmd pg_isready␊
                --health-interval 10s␊
                --health-timeout 5s␊
                --health-retries 5␊
              ports:␊
                - 5432:5432␊
          steps:␊
            - name: Checkout␊
              uses: actions/checkout@v1␊
            - name: Setup Node.js␊
              uses: actions/setup-node@v1␊
              with:␊
                node-version: 16␊
            - name: Run NPM Install␊
              run: yarn install␊
            - name: Run NPM Test␊
              run: yarn test␊
      `,
      'test-output/package.json': `{␊
        "name": "test-output",␊
        "version": "1.0.0",␊
        "main": "index.js",␊
        "license": "MIT"␊
      }␊
      `,
    }

> seam-plop github-ci-vercel-deploy

    {
      'test-output/.github/vercel-deploy.yml': `# Generated by seam-plop␊
      name: Deploy to Vercel␊
      on:␊
        push:␊
          branches: ["main"]␊
      jobs:␊
        migrate_and_deploy:␊
          if: "!contains(github.event.head_commit.message, 'skip ci')"␊
          name: Migrate and Deploy␊
          runs-on: ubuntu-20.04␊
          timeout-minutes: 10␊
          steps:␊
            - name: Checkout␊
              uses: actions/checkout@v1␊
            - name: Setup Node.js␊
              uses: actions/setup-node@v2␊
              with:␊
                node-version: 16␊
                registry-url: "https://npm.pkg.github.com"␊
                cache: "yarn"␊
            - name: Tell Vercel to deploy␊
              uses: amondnet/vercel-action@v25.1.0␊
              with:␊
                vercel-token: $           # Org Secret␊
                vercel-project-id: $ # Repo Secret␊
                vercel-org-id: $        # Org Secret␊
                scope: $                # Org Secret␊
                vercel-args: --prod`,
      'test-output/package.json': `{␊
        "name": "test-output",␊
        "version": "1.0.0",␊
        "main": "index.js",␊
        "license": "MIT"␊
      }␊
      `,
    }

> seam-plop github-ci-release no

    {
      'test-output/.github/workflows/npm-semantic-release.yml': `# Generated by seam-plop␊
      name: NPM Semantic Release␊
      on:␊
        push:␊
          branches:␊
            - main␊
      jobs:␊
        publish:␊
          if: "!contains(github.event.head_commit.message, 'skip ci')"␊
          name: Release␊
          runs-on: ubuntu-20.04␊
          steps:␊
            - name: Checkout␊
              uses: actions/checkout@v1␊
            - name: Setup Node.js␊
              uses: actions/setup-node@v2␊
              with:␊
                node-version: "16.x"␊
                registry-url: "https://registry.npmjs.org"␊
            - name: Install dependencies␊
              env:␊
                NODE_AUTH_TOKEN: $␊
              run: yarn install␊
            - name: Release␊
              env:␊
                NODE_AUTH_TOKEN: $␊
                GITHUB_TOKEN: $␊
              run: npx semantic-release␊
      `,
      'test-output/package.json': `{␊
        "name": "test-output",␊
        "version": "1.0.0",␊
        "main": "index.js",␊
        "license": "MIT"␊
      }␊
      `,
      'test-output/release.config.js': `module.exports = {␊
        branches: ["main"],␊
        plugins: [␊
          "@semantic-release/commit-analyzer",␊
          "@semantic-release/release-notes-generator",␊
          ["@semantic-release/npm", { npmPublish: true }],␊
          [␊
            "@semantic-release/git",␊
            {␊
              assets: ["package.json"],␊
              message:␊
                "chore(release): ${nextRelease.version} [skip ci]\\n\\n${nextRelease.notes}",␊
            },␊
          ],␊
        ],␊
      }␊
      `,
    }

> seam-plop github-ci-release yes

    {
      'test-output/.github/workflows/npm-semantic-release.yml': `# Generated by seam-plop␊
      name: NPM Semantic Release␊
      on:␊
        push:␊
          branches:␊
            - main␊
      jobs:␊
        publish:␊
          if: "!contains(github.event.head_commit.message, 'skip ci')"␊
          name: Release␊
          runs-on: ubuntu-20.04␊
          steps:␊
            - name: Checkout␊
              uses: actions/checkout@v1␊
            - name: Setup Node.js␊
              uses: actions/setup-node@v2␊
              with:␊
                node-version: "16.x"␊
                registry-url: "https://registry.npmjs.org"␊
            - name: Setup Node.js␊
              uses: actions/setup-node@v2␊
              with:␊
                node-version: "16.x"␊
                registry-url: "https://npm.pkg.github.com"␊
            - name: Install dependencies␊
              env:␊
                NODE_AUTH_TOKEN: $␊
              run: yarn install␊
      `,
      'test-output/package.json': `{␊
        "name": "test-output",␊
        "version": "1.0.0",␊
        "main": "index.js",␊
        "license": "MIT"␊
      }␊
      `,
      'test-output/release.config.js': `module.exports = {␊
        branches: ["main"],␊
        plugins: [␊
          "@semantic-release/commit-analyzer",␊
          "@semantic-release/release-notes-generator",␊
          ["@semantic-release/npm", { npmPublish: true }],␊
          [␊
            "@semantic-release/git",␊
            {␊
              assets: ["package.json"],␊
              message:␊
                "chore(release): ${nextRelease.version} [skip ci]\\n\\n${nextRelease.notes}",␊
            },␊
          ],␊
        ],␊
      }␊
      `,
    }
